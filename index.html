<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‡ÙˆØ§ØªÙ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      background: #f7f8fb;
      font-family: Tahoma, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      color: #222;
    }
    .search-field { width: 100%; padding: 12px 14px; border: 2px solid #e6e9ee; border-radius: 12px; font-size: 16px; }
    #result { display: grid; grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); gap: 25px; justify-items: center; align-items: start; padding: 30px; }
    .result-item { position: relative; width: 250px; height: 320px; box-shadow: 0 35px 80px rgba(0,0,0,0.15); background:#fff; border-radius:15px; overflow:visible; cursor:pointer; transition: transform .25s ease; }
    .result-item:hover { transform: translateY(-5px); }
    .result-item .imgBox { position: absolute; left: 50%; top: -41px; transform: translateX(-50%); width: 150px; height: 174px; background: #fff; border-radius: 20px; box-shadow:0 15px 50px rgba(0,0,0,0.35); overflow:hidden; }
    .result-item .imgBox img { width: 100%; height: 100%; object-fit: cover; }
    .result-item .content { position: absolute; bottom: 0; width:100%; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; }
    .result-item .fw-bold { margin-top:110px; font-size:1.1rem; font-weight:700; color:#f30707; }
    .result-item .subtitle { font-size:1rem; font-weight:500; color:#555; margin-top:5px; }
    .result-item .modelsTitle { font-size:0.85rem; color:#666; line-height:1.4rem; margin-top:10px; padding:0 10px; }
    .col-lg-custom { flex: 0 0 20%; max-width: 20%; }
    @media (max-width:1199px) { .col-lg-custom { flex:0 0 33.33%; max-width:33.33%; } }
    @media (max-width:767px) { .col-lg-custom { flex:0 0 48%; max-width:48%; } }
    @media (max-width:479px) { .col-lg-custom { flex:0 0 100%; max-width:100%; } }
    .modal.fade .modal-dialog { transition: transform .25s ease-out; transform: translateY(-12px); }
    .modal.show .modal-dialog { transform: translateY(0); }
  </style>
</head>
<body>
  <div class="container my-4">
    <div class="card mb-4 shadow-sm">
      <div class="card-body">
        <h5 class="text-center mb-3 fw-bold text-primary">ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‡ÙˆØ§ØªÙ</h5>
        <form id="searchForm" class="text-center">
          <p class="message mb-3">Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø« Ø«Ù… Ø§Ø¶ØºØ· Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ <em>Enter</em></p>
          <input type="search" class="search-field form-control mb-3 text-center" id="phoneInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ù‡Ø§ØªÙ..." required />
          <button type="submit" class="btn btn-primary w-100 py-2 fw-bold">Ø¨Ø­Ø«</button>
        </form>
      </div>
    </div>

    <div class="card shadow-sm border-0 rounded-4 mb-4">
      <div class="card-body">
        <h5 class="text-center mb-4 text-primary fw-bold">ğŸ“± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</h5>
        <div id="resultsInfo" class="mb-3 text-center fw-bold text-primary"></div>
        <div id="result" class="row g-3 justify-content-start"></div>
      </div>
    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª -->
  <div class="modal fade" id="specsModal" tabindex="-1" aria-labelledby="specsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content shadow-lg rounded-4">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="modalTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‡Ø§ØªÙ</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
        </div>
        <div class="modal-body" id="specsModalBody">
          <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-3 text-muted">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    async function getDetails(url, phoneImg) {
      const modalBody = document.getElementById("specsModalBody");
      modalBody.innerHTML = `<div class='alert alert-info text-center'>ğŸ“± Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª...</div>`;
      try {
        const res = await fetch(`/api/details?url=${encodeURIComponent(url)}`);
        const data = await res.json();
        if (data.error) {
          modalBody.innerHTML = `<div class='alert alert-danger text-center'>âŒ ${data.error}</div>`;
          return;
        }
        modalBody.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`; // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªÙ‹Ø§
      } catch(err) {
        console.error(err);
        modalBody.innerHTML = `<div class='alert alert-danger text-center'>âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</div>`;
      }
    }

    const form = document.getElementById("searchForm");
    const input = document.getElementById("phoneInput");
    const resultDiv = document.getElementById("result");
    const resultsInfoDiv = document.getElementById("resultsInfo");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const phone = input.value.trim();
      if (!phone) return;

      resultsInfoDiv.innerHTML = "";
      resultDiv.innerHTML = `<div class='alert alert-info'>ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "${phone}"...</div>`;

      try {
        const res = await fetch(`/api/${encodeURIComponent(phone)}`);
        const data = await res.json();

        if (data.error) {
          resultsInfoDiv.innerHTML = "";
          resultDiv.innerHTML = `<div class='alert alert-danger'>âŒ ${data.error}</div>`;
          return;
        }

        if (!data.mode || data.mode === "list") {
          const resultsPerPage = 10;
          const totalResults = data.totalResults || data.results.length;
          const totalPages = data.totalPages || Math.ceil(totalResults / resultsPerPage);
          resultsInfoDiv.innerHTML = `ğŸ”¹ Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ${totalResults} | Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª: ${totalPages}`;

          let cards = "";
          for (const item of data.results) {
            const chipsetText = Array.isArray(item.chipset) ? item.chipset.join(", ") : item.chipset || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
            const modelText = Array.isArray(item.model) ? item.model.join(", ") : item.model || "";
            cards += `
              <div class="col-lg-custom d-flex justify-content-center">
                <div class="card result-item" data-url="${item.link}" data-img="${item.img || ''}">
                  <div class="imgBox"><img src="${item.img || 'https://via.placeholder.com/150'}" alt="${item.title}"></div>
                  <div class="content">
                    <div class="fw-bold mb-1">${item.title}</div>
                    <div class="subtitle">${chipsetText}</div>
                    <div class="modelsTitle">${modelText}</div>
                  </div>
                </div>
              </div>`;
          }
          resultDiv.innerHTML = cards;

          document.querySelectorAll(".result-item").forEach(card => {
            card.addEventListener("click", () => {
              const phoneUrl = card.getAttribute("data-url");
              const phoneImg = card.getAttribute("data-img") || "";
              new bootstrap.Modal(document.getElementById("specsModal")).show();
              getDetails(phoneUrl, phoneImg);
            });
          });
        } else if (data.mode === "details") {
          let specsHtml = "";
          for (const [key,val] of Object.entries(data.specs)) {
            specsHtml += `<li><strong>${key}:</strong> ${val}</li>`;
          }
          resultDiv.innerHTML = `
            <div class="card p-3 shadow-sm">
              <h5 class="text-center mb-3 fw-bold text-primary">${data.title}</h5>
              <img src="${data.img}" class="rounded mx-auto d-block mb-3" style="max-width:260px;">
              <ul class="list-group list-group-flush">${specsHtml}</ul>
              <button class="btn btn-primary mt-3 w-100" onclick="getDetails('${data.link}','${data.img}')">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©</button>
            </div>`;
        }
      } catch(err) {
        resultsInfoDiv.innerHTML = "";
        resultDiv.innerHTML = `<div class='alert alert-danger'>âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</div>`;
      }
    });
  </script>
</body>
</html>
