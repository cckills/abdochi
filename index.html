<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‡ÙˆØ§ØªÙ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Font Awesome CDN (Ø¥Ù† Ø±ØºØ¨Øª Ø¨Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø§Ø­Ù‚Ù‹Ø§) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

    <style>
 #brand-conversions {
    display: none;
    opacity: 0;
    font-size: 13px;
    text-align: center;
    margin-top: 6px;
    transition: opacity 0.4s ease;
  }
  #brand-conversions.show {
    display: block;
    opacity: 1;
  }
  #brand-conversions small {
    margin: 0 4px;
    font-family: monospace;
    padding: 2px 6px;
    border-radius: 6px;
  }
  #brand-conversions .orig { background: #e9ecef; color: #000; }
  #brand-conversions .map1 { background: #d1ecf1; color: #0c5460; }
  #brand-conversions .map2 { background: #f8d7da; color: #721c24; }
  #brand-conversions .map3 { background: #d4edda; color: #155724; }
  
/* Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø¹Ø§Ù…Ø© */
select.dropdown.select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  cursor: pointer;
  background-color: #f13ebc;
  color: rgb(123, 238, 128);
  width: 250px;
  font-size: 20px;
  outline: none;
  /* Ù…Ù„Ø§Ø­Ø¸Ø©: ØªÙ… Ø­Ø°Ù border Ù…Ø²Ø¯ÙˆØ¬ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†Ø¸ÙŠÙ */
}

/* Ø§Ù„Ø®Ø· ÙˆØ§Ù„Ø®Ù„ÙÙŠØ© */
body {
  background: #f7f8fb;
  font-family: Tahoma, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  color: #222;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø« */
.search-modal-box {
  max-width: 720px;
  margin: 48px auto;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 6px 22px rgba(13, 110, 253, 0.06);
  padding: 26px;
}

/* Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« */
.search-field {
  width: 100%;
  padding: 12px 14px;
  border: 2px solid #e6e9ee;
  border-radius: 12px;
  font-size: 16px;
  transition: box-shadow .15s, border-color .15s;
}
.search-field:focus {
  outline: none;
  border-color: #bcd7ff;
  box-shadow: 0 6px 18px rgba(13,110,253,0.06);
}

/* ØªÙˆØ²ÙŠØ¹ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø´Ø¨ÙƒØ© */
#result {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
  gap: 25px;
  justify-items: center;
  align-items: start;
  padding: 30px;
  width: 100%;
  box-sizing: border-box;
}

/* ÙƒØ§Ø±Øª ØªØµÙ…ÙŠÙ… */
.result-item {
  position: relative;
  width: 250px;
  height: 320px;
  box-shadow: 0 35px 80px rgba(0, 0, 0, 0.15);
  background: #fff;
  border-radius: 15px;
  overflow: visible;
  cursor: pointer;
  transition: transform 0.25s ease;
}
.result-item:hover {
  transform: translateY(-5px);
}

/* ØµÙˆØ±Ø© Ø§Ù„Ù‡Ø§ØªÙ */
.result-item .imgBox {
  position: absolute;
  left: 50%;
  top: -41px;
  transform: translateX(-50%);
  width: 150px;
  height: 174px;
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 15px 50px rgba(0, 0, 0, 0.35);
  overflow: hidden;
}
.result-item .imgBox img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒØ§Ø±Øª */
.result-item .content {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
}

/* Ù†ØµÙˆØµ Ø§Ù„ÙƒØ§Ø±Øª */
.result-item .fw-bold {
  margin-top: 110px;
  font-size: 1.1rem;
  font-weight: 700;
  color: #f30707;
}
.result-item .subtitle {
  font-size: 1rem;
  font-weight: 500;
  color: #555;
  margin-top: 5px;
}
.result-item .modelsTitle {
  font-size: 0.85rem;
  color: #666;
  line-height: 1.4rem;
  margin-top: 10px;
  padding: 0 10px;
}

/* Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
.chipset-btn,
.model-btn {
  display: block;
  width: 100%;
  text-align: left;
  direction: ltr;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: 13px;
  border-radius: 8px;
}
.chipset-btn { border-color: rgba(13,110,253,0.15); color: #0d6efd; }
.model-btn { border-color: rgba(25,135,84,0.12); color: #198754; }

/* ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
.col-lg-custom { flex: 0 0 20%; max-width: 20%; }
@media (max-width: 1199px) { .col-lg-custom { flex: 0 0 33.33%; max-width: 33.33%; } }
@media (max-width: 767px) { .col-lg-custom { flex: 0 0 48%; max-width: 48%; } }
@media (max-width: 479px) { .col-lg-custom { flex: 0 0 100%; max-width: 100%; } }

/* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª (Ù…ÙˆØ¯Ø§Ù„) */
.aps-feature-card {
  background: linear-gradient(180deg, #f8fbff 0%, #ffffff 100%);
  padding: 16px;
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(12, 28, 55, 0.04);
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
.aps-list-icon {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  margin-bottom: 10px;
  color: #fff;
}
.aps-icon-mobile { background:#0d6efd; }
.aps-icon-mobile::before { content:"ğŸ“±"; }
.aps-icon-cpu { background:#198754; }
.aps-icon-cpu::before { content:"ğŸ§ "; }
.aps-icon-camera { background:#fd7e14; }
.aps-icon-camera::before { content:"ğŸ“¸"; }
.aps-icon-hdd { background:#6f42c1; }
.aps-icon-hdd::before { content:"ğŸ’¾"; }
.aps-icon-code { background:#20c997; }
.aps-icon-code::before { content:"âš™ï¸"; }
.aps-icon-battery { background:#ffc107; color:#000; }
.aps-icon-battery::before { content:"ğŸ”‹"; }

/* ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
.nav-tabs { overflow-x:auto; white-space:nowrap; flex-wrap:nowrap !important; }
.nav-tabs .nav-link { font-weight:600; color:#0d6efd; border-radius:12px 12px 0 0; margin:2px; }
.nav-tabs .nav-link.active { background:#0d6efd; color:#fff; }

.tab-content ul li {
  border-bottom: 1px solid #eee;
  padding: 6px 0;
}

/* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 600px) {
  .card {
    width: 200px;
    height: 280px;
  }

  .imgBox {
    width: 120px;
    height: 140px;
    top: -30px;
  }

  .fw-bold {
    font-size: 1rem;
    margin-top: 90px;
  }

  .subtitle {
    font-size: 0.9rem;
  }

  .modelsTitle {
    font-size: 0.75rem;
    line-height: 1.2rem;
  }
}

/* Ù…Ø³Ø§ÙØ© Ø¨Ø³ÙŠØ·Ø© */
.mb-1 { margin-bottom: .25rem !important; }

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø­Ø« ÙˆÙ…Ø³Ø­ */
#brand-search-btn, #clearHistoryBtn {
  width: 100%;
  font-size: 1rem;
  padding: 10px;
}

.page-fade.fade-out { opacity: 0.35; }

/* Ù„Ù… ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¯ÙŠÙÙˆÙ„Ø§Øª bootstrap .d-flexØŒ Ù„ÙƒÙ† Ø¥Ù† Ø£Ø±Ø¯Øª Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø§Ø³ØªØ®Ø¯Ù… ÙØ¦Ø© Ø®Ø§ØµØ© */
.d-flex { display: flex !important; flex-direction: row; align-items: flex-end; }

/* Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
.modal.fade .modal-dialog {
  transition: transform .25s ease-out;
  transform: translateY(-12px);
}
.modal.show .modal-dialog {
  transform: translateY(0);
}
    </style>
  </head>
  <body>
<div class="container my-4">
  <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¨Ø­Ø« -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="text-center mb-3 fw-bold text-primary">ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‡ÙˆØ§ØªÙ</h5>

      <form id="searchForm" class="text-center" onsubmit="return false;">
        <p class="message mb-3"> Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø³ÙŠØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦Ù‰  </p>
<div id="brand-conversions">
  <small class="orig" id="conv-orig"></small>
  <small class="map1" id="conv-map1"></small>
  <small class="map2" id="conv-map2"></small>
  <small class="map3" id="conv-map3"></small>
</div>
<input type="search" class="form-control text-center" id="phoneInput" name="s"
  placeholder="" required
  style="flex:1; max-width:230px; height:44px; border-radius:8px; font-size:15px; display:none;">

        <div id="brand-search-box" class="text-center mt-4">
          <div class="d-flex justify-content-center align-items-center flex-wrap gap-2 mb-3">
            <select class="dropdown select form-select"
             style="flex:1; max-width:308px; height:44px; border-radius:8px; font-size:15px;" id="brandDropdown">
              <option value="" selected disabled>Ø§Ø®ØªØ± Ø¹Ù„Ø§Ù…Ø© ØªØ¬Ø§Ø±ÙŠØ©</option>
              <option value="4">Huawei</option>
              <option value="5">Samsung</option>
              <option value="6">Apple</option>
              <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª -->
            </select>

            <!-- Ø¨Ø­Ø« Ø¹Ù† Ù…Ø§Ø±ÙƒÙ‡ -->
            <input type="text" id="brand-search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø§Ø±ÙƒØ©..."
              class="form-control text-center"
              style="flex:1; max-width:540px; height:44px; border-radius:8px; font-size:15px;">

            <!-- Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙÙ„ØªØ±Ø© -->
             <button id="brand-clear-btn" type="button"
              class="btn btn-secondary px-3 py-2 d-flex align-items-center justify-content-center"
              style="min-width:361px; border-radius:8px; font-size:14px;">
              ğŸ§¹ <span class="ms-1">Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙÙ„ØªØ±Ø©</span>
            </button>
          </div>


          <!-- ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ -->
          <div class="d-flex justify-content-center align-items-center gap-3 mt-4">
            <button id="brand-search-btn" type="button"
            class="btn btn-success fw-bold px-4 py-2 d-flex align-items-center justify-content-center"
            style="min-width:170px; border-radius:8px;"> ğŸ§­ <span class="ms-1">ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
<div class="container my-4">
  <div class="card shadow-sm border-0 rounded-4">
    <div class="card-body">
      <h5 class="text-center mb-4 text-primary fw-bold">ğŸ“± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</h5>
      <p id="result-info" style="text-align:center;margin-top:10px;font-weight:bold;color:#222;"></p>
      <div id="result" class="row g-3 justify-content-start"></div>
      <div id="pagination" class="text-center my-3"></div>
    </div>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª -->
<div class="modal fade" id="specsModal" tabindex="-1" aria-labelledby="specsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content shadow-lg rounded-4">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="modalTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‡Ø§ØªÙ</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
      </div>
      <div class="modal-body" id="specsModalBody">
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status"></div>
          <p class="mt-3 text-muted">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ÙƒÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª ÙÙŠ Ù…Ù„Ù ÙˆØ§Ø­Ø¯ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© -->
<script>
/* =================== JavaScript Ù…Ù†Ù‚Ø­ ÙˆÙ…Ù†Ø¸Ù… =================== */

/* Ø¹Ù†Ø§ØµØ± Ø±Ø¦ÙŠØ³ÙŠØ© */
const form = document.getElementById("searchForm");
const input = document.getElementById("phoneInput");
const resultDiv = document.getElementById("result");
const resultInfoEl = document.getElementById("result-info");
const paginationEl = document.getElementById("pagination");
const brandSearchInput = document.getElementById("brand-search");
const brandClearBtn = document.getElementById("brand-clear-btn");
const brandSearchBtn = document.getElementById("brand-search-btn");
const brandDropdown = document.getElementById("brandDropdown");
const specsModalEl = document.getElementById("specsModal");

/* Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
let allResults = [];
async function getDetails(url, phoneImg) {
  const modalBody = document.getElementById("specsModalBody");
  modalBody.innerHTML = `<div class='alert alert-info text-center'>ğŸ“± Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª...</div>`;

  try {
    const res = await fetch(`/api/details?url=${encodeURIComponent(url)}`);
    const data = await res.json();

    if (data.error) {
      modalBody.innerHTML = `<div class='alert alert-danger text-center'>âŒ ${data.error}</div>`;
      return;
    }

    if (!data.specs || Object.keys(data.specs).length === 0) {
      modalBody.innerHTML = `<div class='alert alert-warning text-center'>âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…ÙˆØ§ØµÙØ§Øª.</div>`;
      return;
    }

    const sections = {
      "Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©": ["Ø§Ù„Ø¥ØµØ¯Ø§Ø±", "Ø§Ù„Ù…Ø§Ø±ÙƒØ©", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„Ù†ÙˆØ¹", "Ø§Ù„Ø®Ø§Ù…Ø©"],
      Ø§Ù„Ø³Ø¹Ø±: ["Ø§Ù„Ø³Ø¹Ø±", "Price", "Ø§Ù„Ø£Ø³Ø¹Ø§Ø±"],
      Ø§Ù„Ù†Ø¸Ø§Ù…: ["Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„", "Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©", "Ø§Ù„Ø¥ØµØ¯Ø§Ø±"],
      Ø§Ù„Ø´Ø§Ø´Ø©: ["Ø§Ù„Ø´Ø§Ø´Ø©", "Ø§Ù„Ù†ÙˆØ¹", "Ø§Ù„Ø¯Ù‚Ø©", "Ø§Ù„Ø³Ø·ÙˆØ¹", "Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«"],
      Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ["Ø§Ù„Ø°Ø§ÙƒØ±Ø©", "Ø§Ù„ØªØ®Ø²ÙŠÙ†", "SD", "Ø§Ù„Ø±Ø§Ù…"],
      Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯: ["Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯", "Ø§Ù„ÙˆØ²Ù†", "Ø§Ù„Ø­Ø¬Ù…"],
      Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: ["Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§", "Ø§Ù„Ø®Ù„ÙÙŠØ©", "Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©", "Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"],
      Ø§Ù„ØµÙˆØª: ["Ø§Ù„ØµÙˆØª", "Ø³Ù…Ø§Ø¹Ø§Øª", "Ø¬Ø§Ùƒ"],
      Ø£Ø®Ø±Ù‰: [],
    };

    const icons = {
      "Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©": "ğŸ“‹",
      Ø§Ù„Ø³Ø¹Ø±: "ğŸ’°",
      Ø§Ù„Ù†Ø¸Ø§Ù…: "âš™ï¸",
      Ø§Ù„Ø´Ø§Ø´Ø©: "ğŸ“±",
      Ø§Ù„Ø°Ø§ÙƒØ±Ø©: "ğŸ’¾",
      Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯: "ğŸ“",
      Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: "ğŸ“¸",
      Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©: "ğŸ”‹",
      Ø§Ù„ØµÙˆØª: "ğŸ”ˆ",
      Ø£Ø®Ø±Ù‰: "ğŸ“",
    };

    // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
    const grouped = {};
    for (const [key, val] of Object.entries(data.specs)) {
      let found = false;
      for (const [section, keywords] of Object.entries(sections)) {
        if (keywords.some((k) => key.includes(k))) {
          (grouped[section] ??= []).push({ key, val });
          found = true;
          break;
        }
      }
      if (!found) (grouped["Ø£Ø®Ø±Ù‰"] ??= []).push({ key, val });
    }

    const tabs = Object.keys(sections);
    const navTabs = tabs.map((tab, i) => `
      <li class="nav-item" role="presentation">
        <button class="nav-link ${i === 0 ? "active" : ""}" id="tab-${i}" data-bs-toggle="tab" data-bs-target="#content-${i}" type="button" role="tab">
          ${icons[tab] || ""} ${tab}
        </button>
      </li>
    `).join("");

    const tabContents = tabs.map((tab, i) => {
      if (tab === "Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©") {
        const mainImage = phoneImg || data.img || "https://telfonak.com/wp-content/uploads/2023/12/huawei-y9-prime-2019.webp";

        const featureCards = [
          {
            key: "Ø§Ù„Ø´Ø§Ø´Ø©",
            val: (() => {
              const screenRaw = data.specs["Ø§Ù„Ø´Ø§Ø´Ø©"] || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
              if (screenRaw === "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©") return screenRaw;

              const typeMatch = screenRaw.match(/(IPS\s*LCD|AMOLED|OLED|Super\s*AMOLED|LTPO|PLS|TFT)/i);
              const type = typeMatch ? typeMatch[0].replace(/\s+/g, " ").trim().toUpperCase() : "";

              const sizeMatch = screenRaw.match(/(\d+(\.\d+)?)\s*(Ø¨ÙˆØµØ©|Ø¨ÙˆØµÙ‡|inch|")/i);
              const size = sizeMatch ? `${sizeMatch[1]} Ø¨ÙˆØµØ©` : "";

              let res = "";
              if (/FHD/i.test(screenRaw)) res = "Ø¨Ø¯Ù‚Ø© FHD+";
              else if (/HD\+/i.test(screenRaw)) res = "Ø¨Ø¯Ù‚Ø© HD+";
              else if (/QHD/i.test(screenRaw)) res = "Ø¨Ø¯Ù‚Ø© QHD+";
              else if (/UHD|4K/i.test(screenRaw)) res = "Ø¨Ø¯Ù‚Ø© 4K";
              else {
                const resMatch = screenRaw.match(/(\d{3,4})\s*[xÃ—]\s*(\d{3,4})/i);
                if (resMatch) {
                  const width = Math.max(resMatch[1], resMatch[2]);
                  res = width >= 2000 ? "Ø¨Ø¯Ù‚Ø© FHD+" : "Ø¨Ø¯Ù‚Ø© HD+";
                }
              }
              if (type || size || res) {
                return `${type}${type && size ? " Ø¨Ø­Ø¬Ù… " : ""}${size}${(type || size) && res ? " " : ""}${res}`.trim();
              } else {
                return screenRaw;
              }
            })(),
            icon: "aps-icon-mobile",
          },
          { key: "Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬", val: data.specs["Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬"] || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯", icon: "aps-icon-cpu" },
          {
            key: "Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª",
            val: (() => {
              const backRaw = data.specs["ÙƒØ§Ù…ÙŠØ±Ø§ Ø®Ù„ÙÙŠØ©"] || data.specs["Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©"] || "";
              const frontRaw = data.specs["ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù…Ø§Ù…ÙŠØ©"] || data.specs["Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©"] || "";
              const extractMP = (text) => {
                const matches = text.match(/(\d+)\s*(?:Ù…ÙŠØ¬Ø§|Ù…\.Ø¨)/g);
                if (!matches) return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
                const clean = matches.map((m) => m.replace(/\D/g, ""));
                return clean.join("+") + " Ù….Ø¨";
              };
              const back = extractMP(backRaw);
              const front = extractMP(frontRaw);
              if (back !== "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©" && front !== "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©") return `Ø®Ù„ÙÙŠØ© ${back} / Ø£Ù…Ø§Ù…ÙŠØ© ${front}`;
              if (back !== "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©") return `Ø®Ù„ÙÙŠØ© ${back}`;
              if (front !== "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©") return `Ø£Ù…Ø§Ù…ÙŠØ© ${front}`;
              return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
            })(),
            icon: "aps-icon-camera",
          },
          {
            key: "Ø§Ù„Ø°Ø§ÙƒØ±Ø© + Ø§Ù„Ø±Ø§Ù…",
            val: (() => {
              const storageKey = Object.keys(data.specs).find((k) => /Ø°Ø§ÙƒØ±Ø©|ØªØ®Ø²ÙŠÙ†|Ø¯Ø§Ø®Ù„ÙŠØ©/i.test(k)) || "";
              const ramKey = Object.keys(data.specs).find((k) => /Ø±Ø§Ù…|Ø§Ù„Ø±Ø§Ù…Ø§Øª|Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©/i.test(k)) || "";
              const storage = storageKey ? data.specs[storageKey].replace(/\s*\.\s*$/, "") : "";
              const ram = ramKey ? data.specs[ramKey].replace(/\s*\.\s*$/, "") : "";
              if (storage && ram) return `${storage} + ${ram}`;
              if (storage) return storage;
              if (ram) return ram;
              return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
            })(),
            icon: "aps-icon-hdd",
          },
          { key: "Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„", val: data.specs["Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„"] || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯", icon: "aps-icon-code" },
          {
            key: "Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©",
            val: (() => {
              const capacity = data.specs["Ø³Ø¹Ø© Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©"] || data.specs["Battery Capacity"] || "";
              const charging = data.specs["Ù‚Ø¯Ø±Ø© Ø§Ù„Ø´Ø­Ù†"] || data.specs["Ø§Ù„Ø´Ø­Ù†"] || "";
              if (!capacity && !charging) return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
              const capClean = capacity.replace(/Ù…Ù„ÙŠ|Ù…Ù„Ù„ÙŠ|mAh/gi, "").trim().replace(/\.+$/, "") + " Ù….Ø£";
              const chargeClean = charging.replace(/ÙˆØ§Ø·|W/gi, "").trim().replace(/\.+$/, "") + " ÙˆØ§Ø·";
              if (capacity && charging) return `${capClean} / ${chargeClean}`;
              if (capacity) return capClean;
              if (charging) return chargeClean;
              return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
            })(),
            icon: "aps-icon-battery",
          },
          // Ø¥Ø¶Ø§ÙØ© ÙƒØ§Ø±Øª Ø§Ù„Ø³Ø¹Ø± Ø¶Ù…Ù† Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
          {
            key: "Ø§Ù„Ø³Ø¹Ø±",
            val: (() => {
              let priceVal = grouped["Ø§Ù„Ø³Ø¹Ø±"]?.[0]?.val;
              if (!priceVal && grouped["Ø£Ø®Ø±Ù‰"]) {
                const priceItem = grouped["Ø£Ø®Ø±Ù‰"].find(item =>
                  item.key.includes("Ø§Ù„Ø³Ø¹Ø±") || item.key.toLowerCase().includes("price")
                );
                priceVal = priceItem?.val;
              }
              return priceVal || "ØºÙŠØ± Ù…ØªÙˆÙØ±";
            })(),
            icon: "aps-icon-cash",
            style: "border-success text-success",
          },
        ];

        const cardsHtml = featureCards.map(item => `
          <div class="col-12 col-md-6">
            <div class="aps-feature-card ${item.style || ""}">
              <div class="aps-list-icon ${item.icon}"></div>
              <div class="aps-feature-info text-center mt-2">
                <strong>${item.key}</strong><br>
                <span>${item.val}</span>
              </div>
            </div>
          </div>
        `).join("");

        return `
          <div class="tab-pane fade show active" id="content-${i}" role="tabpanel">
            <div class="d-flex flex-column flex-lg-row align-items-center gap-4">
              <div class="text-center flex-shrink-0">
                <div class="aps-main-image mb-3">
                  <img fetchpriority="high" class="aps-image-zoom rounded shadow-sm" src="${mainImage}" style="width:100%; max-width:400px;" alt="${data.title}">
                  <div class="aps-img-loader"><span class="aps-loader"></span></div>
                </div>
                <h4 class="fw-bold mt-2">${data.title}</h4>
              </div>
              <div class="flex-grow-1 w-100">
                <div class="row g-3 justify-content-start">
                  ${cardsHtml}
                </div>
              </div>
            </div>
          </div>
        `;
      }

      if (tab === "Ø§Ù„Ø³Ø¹Ø±") {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³Ø¹Ø± Ø£ÙˆÙ„Ù‹Ø§ ÙÙŠ grouped["Ø§Ù„Ø³Ø¹Ø±"]
        let priceVal = grouped["Ø§Ù„Ø³Ø¹Ø±"]?.[0]?.val;
        if (!priceVal && grouped["Ø£Ø®Ø±Ù‰"]) {
          const priceItem = grouped["Ø£Ø®Ø±Ù‰"].find(item =>
            item.key.includes("Ø§Ù„Ø³Ø¹Ø±") || item.key.toLowerCase().includes("price")
          );
          priceVal = priceItem?.val;
        }
        priceVal = priceVal || "ØºÙŠØ± Ù…ØªÙˆÙØ±";

        return `<div class="tab-pane fade" id="content-${i}" role="tabpanel">
          <div class="card border-success text-center shadow-sm p-4 bg-light">
            <h4 class="text-success fw-bold mb-3">ğŸ’° Ø§Ù„Ø³Ø¹Ø±</h4>
            <p class="fs-4 text-success">${priceVal}</p>
          </div>
        </div>`;
      }

      const sectionItems = grouped[tab]?.length
        ? grouped[tab].map(item => `<li class="list-group-item d-flex justify-content-between align-items-center"><strong>${item.key}</strong><span>${item.val}</span></li>`).join("")
        : "<li class='list-group-item text-center text-muted'>âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©.</li>";

      return `<div class="tab-pane fade" id="content-${i}" role="tabpanel"><ul class="list-group list-group-flush">${sectionItems}</ul></div>`;
    }).join("");

    modalBody.innerHTML = `
      <ul class="nav nav-tabs justify-content-center flex-wrap" id="specTabs" role="tablist">${navTabs}</ul>
      <div class="tab-content p-3 border border-top-0 rounded-bottom bg-light mt-1" id="specTabsContent">${tabContents}</div>
    `;

    new bootstrap.Modal(document.getElementById("specsModal")).show();

  } catch (err) {
    console.error(err);
    modalBody.innerHTML = `<div class='alert alert-danger text-center'>âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</div>`;
  }
}

/* Ø­Ù…Ø§ÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ù…Ù† XSS Ù„Ù„Ù€ alt/text */
function escapeHtml(unsafe) {
  return (unsafe === null || unsafe === undefined) ? "" : String(unsafe)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

/* Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±Ø³Ù… + Ø§Ù„ØªØ¸Ù„ÙŠÙ„ + Ø§Ù„ØªØµÙØ­ (ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ results ÙƒÙ‚Ø§Ø¦Ù…Ø©) */
function renderFilteredResults(results, totalMatched = results.length, highlightQuery = "") {
  resultDiv.innerHTML = "";
  paginationEl.innerHTML = "";

  if (!Array.isArray(results) || results.length === 0) {
    resultDiv.innerHTML = `<div class="text-center text-muted p-4">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.</div>`;
    resultInfoEl.textContent = "Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: 0";
    return;
  }

  const totalAll = allResults.length || results.length;
  const itemsPerPage = 20;
  let currentPage = 1;
  const totalPages = Math.ceil(results.length / itemsPerPage);

  function renderPage(page) {
    const start = (page - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const pageItems = results.slice(start, end);

    resultDiv.innerHTML = renderCardsForItems(pageItems);

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø©
    document.querySelectorAll(".result-item").forEach(card => {
      card.addEventListener("click", () => {
        const phoneUrl = card.getAttribute("data-url");
        const phoneImg = card.getAttribute("data-img") || "";
        new bootstrap.Modal(document.getElementById("specsModal")).show();
        getDetails(phoneUrl, phoneImg);
      });
    });

    resultInfoEl.textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ${totalAll} | Ø§Ù„ØµÙØ­Ø© ${page} Ù…Ù† ${totalPages} | Ø¹Ø±Ø¶ Ù…ØªØ·Ø§Ø¨Ù‚: ${totalMatched}`;
  }

  function renderPagination() {
    if (totalPages <= 1) { paginationEl.innerHTML = ""; return; }

    let html = `<nav><ul class="pagination justify-content-center flex-wrap">`;

    html += `<li class="page-item ${currentPage === 1 ? "disabled" : ""}">
               <a class="page-link" href="#" data-page="${currentPage - 1}">Ø§Ù„Ø³Ø§Ø¨Ù‚</a></li>`;

    for (let i = 1; i <= totalPages; i++) {
      html += `<li class="page-item ${i === currentPage ? "active" : ""}">
                 <a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
    }

    html += `<li class="page-item ${currentPage === totalPages ? "disabled" : ""}">
               <a class="page-link" href="#" data-page="${currentPage + 1}">Ø§Ù„ØªØ§Ù„ÙŠ</a></li>`;

    html += "</ul></nav>";
    paginationEl.innerHTML = html;

    paginationEl.querySelectorAll("a.page-link").forEach(link => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const p = parseInt(link.getAttribute("data-page"));
        if (p >= 1 && p <= totalPages) {
          currentPage = p;
          renderPage(currentPage);
          renderPagination();
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      });
    });
  }

  renderPage(currentPage);
  renderPagination();
}




/* ========== Ø­Ø¯Ø« Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ù… Ø§Ù„Ø¹Ø±Ø¶ ========== */
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const phone = input.value.trim();
  if (!phone) return;

  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø¯ÙŠÙ…
  resultInfoEl.textContent = "";
  paginationEl.innerHTML = "";
  resultDiv.innerHTML = "";

  // Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
  resultDiv.innerHTML = `
    <div class="d-flex flex-column justify-content-center align-items-center py-5" style="min-height: 300px;">
      <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</span>
      </div>
      <div class="text-center text-secondary fs-5">
        ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† <strong>${escapeHtml(phone)}</strong>...
      </div>
    </div>
  `;

  try {
    const res = await fetch(`/api/${encodeURIComponent(phone)}`);
    const data = await res.json();

    if (data.error) {
      resultDiv.innerHTML = `<div class='alert alert-danger'>âŒ ${escapeHtml(data.error)}</div>`;
      return;
    }

    // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    allResults = Array.isArray(data.results) ? data.results : [];

    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØªØ¹ÙŠØ¯ ÙˆØ¶Ø¹ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©
    if (data.mode === "details") {
      // Ø¹Ø±Ø¶ Ù…ÙˆØ§ØµÙØ§Øª Ù…ÙØ±Ø¯Ø©
      let specsHtml = "";
      if (data.specs && typeof data.specs === "object") {
        for (const [key, val] of Object.entries(data.specs)) {
          specsHtml += `<li class="list-group-item"><strong>${escapeHtml(key)}:</strong> ${escapeHtml(val)}</li>`;
        }
      }
      resultDiv.innerHTML = `
        <div class="card p-3 shadow-sm">
          <h5 class="text-center mb-3 fw-bold text-primary">${escapeHtml(data.title || "")}</h5>
          <img src="${escapeHtml(data.img || '')}" class="rounded mx-auto d-block mb-3" style="max-width:260px;">
          <ul class="list-group list-group-flush">${specsHtml}</ul>
          <button class="btn btn-primary mt-3 w-100" onclick="getDetails('${escapeJsArg(data.link || "")}', '${escapeJsArg(data.img || "")}')">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©</button>
        </div>
      `;
      return;
    }

    // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© (mode list Ø£Ùˆ undefined)
    renderFilteredResults(allResults, allResults.length);

  } catch (err) {
    console.error(err);
    resultDiv.innerHTML = `<div class='alert alert-danger'>âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</div>`;
  }
});

/* ØªÙ„Ù…ÙŠØ­Ø§Øª Ù…Ø®ØµØµØ© (tooltip popup Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ badge) */
document.addEventListener("click", (e) => {
  const badge = e.target.closest(".chipset-badge, .model-badge");
  if (!badge) return;

  const tooltipText = badge.getAttribute("data-tooltip");
  if (!tooltipText) return;

  // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ ØªÙ„Ù…ÙŠØ­Ø§Øª Ù…ÙØªÙˆØ­Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§
  document.querySelectorAll(".tooltip-popup").forEach((el) => el.remove());

  // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ„Ù…ÙŠØ­
  const tooltip = document.createElement("div");
  tooltip.className = "tooltip-popup";
  tooltip.textContent = tooltipText;
  document.body.appendChild(tooltip);

  // ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙ„Ù…ÙŠØ­
  const rect = badge.getBoundingClientRect();
  tooltip.style.position = "absolute";
  tooltip.style.top = `${rect.bottom + window.scrollY + 10}px`;
  tooltip.style.left = `${rect.left + window.scrollX}px`;
  tooltip.style.padding = "8px 12px";
  tooltip.style.background = "#333";
  tooltip.style.color = "#fff";
  tooltip.style.borderRadius = "6px";
  tooltip.style.fontSize = "13px";
  tooltip.style.zIndex = "9999";
  tooltip.style.transition = "opacity .25s";
  tooltip.style.opacity = "1";

  // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¹Ù†ØµØ±
  const closeTooltip = (ev) => {
    if (!tooltip.contains(ev.target) && ev.target !== badge) {
      tooltip.remove();
      document.removeEventListener("click", closeTooltip);
    }
  };
  document.addEventListener("click", closeTooltip);
});

/* Ø±Ø¨Ø· Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª (<select>) Ø¨Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« */
if (brandDropdown) {
  brandDropdown.addEventListener("change", () => {
    const selectedBrand = brandDropdown.options[brandDropdown.selectedIndex].text || "";
    input.value = selectedBrand;
    input.focus();
    // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø« ÙÙˆØ± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
    form.requestSubmit();
  });
}

/* Ù…Ù†Ø¹ Enter ÙÙŠ Ø­Ù‚Ù„ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø±Ø¦ÙŠØ³Ù‰ ÙˆØ§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø§Ø±ÙƒØ© Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© */
document.addEventListener("keydown", function (e) {
  if ((e.target.id === "phoneInput" || e.target.id === "brand-search") && e.key === "Enter") {
    e.preventDefault();
    return false;
  }
});

/* Ù…Ù†Ø¹ Enter ÙÙŠ brand-search ØªØ­Ø¯ÙŠØ¯Ù‹Ø§ (Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©) */
if (brandSearchInput) {
  brandSearchInput.addEventListener("keydown", function(e) {
    if (e.key === "Enter") e.preventDefault();
  });
}

/* Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ù† Ù…ØµØ¯Ø± Ø®Ø§Ø±Ø¬ÙŠ (Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§) */
function setResults(results) {
  allResults = results || [];
}

/* Ø¯Ø§Ù„Ø© ÙÙ„ØªØ±Ø© Ø¹Ø§Ù…Ø© */
function filterResults(query) {
  if (!Array.isArray(allResults) || allResults.length === 0) return;
  const q = (query || "").trim().toLowerCase();

  const filtered = allResults.filter(item => {
    const title = (item.title || "").toLowerCase();
    const chipset = (item.chipset || "").toLowerCase();
    const models = Array.isArray(item.model) ? item.model.join(", ").toLowerCase() : (item.model || "").toLowerCase();
    return q === "" || title.includes(q) || chipset.includes(q) || models.includes(q);
  });

  renderFilteredResults(filtered, filtered.length, q);
}


const convBox = document.getElementById("brand-conversions");
const origEl = document.getElementById("conv-orig");
const map1El = document.getElementById("conv-map1");
const map2El = document.getElementById("conv-map2");
const map3El = document.getElementById("conv-map3");

const keyboardMap1 = {
  'Ø¶':'q','Øµ':'w','Ø«':'e','Ù‚':'r','Ù':'t','Øº':'y','Ø¹':'u','Ù‡':'i','Ø®':'o','Ø­':'p',
  'Ø¬':'[','Ø¯':']','Ø´':'a','Ø³':'s','ÙŠ':'d','Ø¨':'f','Ù„':'g','Ø§':'h','Øª':'j','Ù†':'k',
  'Ù…':'l','Ùƒ':';','Ø·':'z','Ø¦':'x','Ø¡':'c','Ø¤':'v','Ø±':'b','Ù„Ø§':'n','Ù‰':'m','Ø©':',','Ùˆ':'.','Ø²':'/','Ø¸':'`'
};
const keyboardMap2 = {
  'Ø¶':'q','Øµ':'w','Ø«':'e','Ù‚':'r','Ù':'t','Øº':'y','Ø¹':'u','Ù‡':'i','Ø®':'o','Ø­':'p',
  'Ø¬':'[','Ø¯':'a','Ø´':'s','Ø³':'d','ÙŠ':'f','Ø¨':'g','Ù„':'h','Ø§':'j','Øª':'k','Ù†':'l',
  'Ù…':';','Ùƒ':'\'','Ø·':'z','Ø¦':'x','Ø¡':'c','Ø¤':'v','Ø±':'b','Ù„Ø§':'n','Ù‰':'m','Ø©':',','Ùˆ':'.','Ø²':'/','Ø¸':'`'
};
const phoneticMap = {
  'Ø§':'a','Ø¨':'b','Øª':'t','Ø«':'th','Ø¬':'j','Ø­':'h','Ø®':'kh','Ø¯':'d','Ø°':'dh','Ø±':'r',
  'Ø²':'z','Ø³':'s','Ø´':'sh','Øµ':'s','Ø¶':'d','Ø·':'t','Ø¸':'z','Ø¹':'a','Øº':'gh','Ù':'f',
  'Ù‚':'q','Ùƒ':'k','Ù„':'l','Ù…':'m','Ù†':'n','Ù‡':'h','Ùˆ':'w','ÙŠ':'y','Ø¡':"'",'Ø©':'h','Ù‰':'a'
};

function convertUsingMap(text, map) {
  return text.split('').map(ch => map[ch] || ch).join('');
}

function smartConvert(txt, map) {
  // Ù†Ø­ÙˆÙ„ ÙƒÙ„ Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø· Ø­Ø³Ø¨ Ø§Ù„Ø®Ø±ÙŠØ·Ø©ØŒ ÙˆÙ†ØªØ±Ùƒ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø±Ù…ÙˆØ² ÙƒÙ…Ø§ Ù‡ÙŠ
  return txt.split('').map(ch => {
    const isArabic = /[\u0600-\u06FF]/.test(ch);
    return isArabic ? (map[ch] || ch) : ch;
  }).join('');
}


function showConversions(txt, c1, c2, c3) {
  origEl.textContent = txt;
  map1El.textContent = c1;
  map2El.textContent = c2;
  map3El.textContent = c3;
  convBox.classList.add("show");
}

function hideConversions() {
  convBox.classList.remove("show");
  setTimeout(() => { convBox.style.display = "none"; }, 400);
}

/* ÙÙ„ØªØ±Ø© ÙÙˆØ±ÙŠØ© Ù…Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª */
let debounceTimer;
if (brandSearchInput) {
  brandSearchInput.addEventListener("input", (e) => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
      const txt = e.target.value.trim().toLowerCase();

      if (!txt) {
        hideConversions();
        if (typeof filterResults === "function") filterResults("");
        return;
      }

      // ğŸ”¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… smartConvert Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† convertUsingMap
      const conv1 = smartConvert(txt, keyboardMap1).toLowerCase();
      const conv2 = smartConvert(txt, keyboardMap2).toLowerCase();
      const conv3 = smartConvert(txt, phoneticMap).toLowerCase();

      convBox.style.display = "block";
      requestAnimationFrame(() => showConversions(txt, conv1, conv2, conv3));

      const candidates = [txt, conv1, conv2, conv3].filter(Boolean);

      if (typeof filterResults === "function" && Array.isArray(allResults)) {
        const merged = candidates.flatMap(q =>
          allResults.filter(item => {
            const title = (item.title || "").toLowerCase();
            const chipset = (item.chipset || "").toLowerCase();
            const models = Array.isArray(item.model)
              ? item.model.join(", ").toLowerCase()
              : (item.model || "").toLowerCase();
            return title.includes(q) || chipset.includes(q) || models.includes(q);
          })
        );
        const unique = Array.from(new Set(merged.map(r => r.title)))
          .map(title => merged.find(r => r.title === title));
        renderFilteredResults(unique, unique.length, txt);
      }
    }, 100);
  });
}

/* Ø²Ø± Ø§Ù„ÙÙ„ØªØ±Ø© */
if (brandSearchBtn) {
  brandSearchBtn.addEventListener("click", function() {
    const query = brandSearchInput ? brandSearchInput.value.trim() : "";
    if (query) brandSearchInput.dispatchEvent(new Event("input"));
  });
}

/* Ø²Ø± Ø§Ù„Ù…Ø³Ø­ */
if (brandClearBtn) {
  brandClearBtn.addEventListener("click", function() {
    if (brandSearchInput) brandSearchInput.value = "";
    hideConversions();
    if (typeof filterResults === "function") filterResults("");
  });
}

/* Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ‡ÙŠØ¦Ø© Ù‚ÙŠÙ… Ø¯Ø§Ø®Ù„ onclick Ù…Ø¹ Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª Ø¢Ù…Ù†Ø© */
function escapeJsArg(s) {
  return String(s || "").replace(/'/g, "\\'").replace(/"/g, '\\"');
}
</script>

<!-- Bootstrap JS (Ù…Ø¶Ù…Ù† Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø©) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  </body>
</html>

