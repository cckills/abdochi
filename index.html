<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‡ÙˆØ§ØªÙ</title>

    <!-- Bootstrap CSS (ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Font Awesome CDN (Ø¥Ù† Ø±ØºØ¨Øª Ø¨Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø§Ø­Ù‚Ù‹Ø§) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
      /* ===========================
         Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙˆØ§Ù„Ù‡ÙŠÙƒÙ„
         (ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„ØµÙŠØ§Ù†Ø©)
         =========================== */

      /* Ø®Ø· Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª */
      body {
        background: #f7f8fb;
        font-family: Tahoma, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        color: #222;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ */
      .search-modal-box {
        max-width: 720px;
        margin: 48px auto;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 6px 22px rgba(13, 110, 253, 0.06);
        padding: 26px;
      }

      /* Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
      .search-field {
        width: 100%;
        padding: 12px 14px;
        border: 2px solid #e6e9ee;
        border-radius: 12px;
        font-size: 16px;
        transition: box-shadow .15s, border-color .15s;
      }
      .search-field:focus {
        outline: none;
        border-color: #bcd7ff;
        box-shadow: 0 6px 18px rgba(13,110,253,0.06);
      }

      .message {
        margin-top: 10px;
        color: #6c757d;
        font-size: 14px;
      }

      /* ===========================
         Ø¨Ø·Ø§Ù‚Ø§Øª Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« (Ø´Ø¨ÙƒØ© Ù…Ø±Ù†Ø©)
         =========================== */

      #result {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
      }

      /* ØªØ¹Ø±ÙŠÙ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø¨Ù…Ø±ÙˆÙ†Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· */
      .phone-card {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 100%;
        background-color: #fff;
        border-radius: 14px;
        box-shadow: 0 6px 18px rgba(22, 28, 45, 0.06);
        transition: transform .18s ease, box-shadow .18s ease;
        cursor: pointer;
        overflow: hidden;
        border: 1px solid rgba(12, 28, 55, 0.04);
      }
      .phone-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 18px 40px rgba(13, 110, 253, 0.08);
      }

      /* ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
      .phone-card .card-img-top {
        width: 100%;
        height: 180px;
        object-fit: cover;
        display: block;
      }

      /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
      .phone-card .card-body {
        padding: 14px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .phone-card .card-title {
        font-size: 15px;
        font-weight: 700;
        color: #0d6efd;
        text-align: center;
        min-height: 46px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Ø£Ø²Ø±Ø§Ø± chipset / model Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
      .chipset-btn,
      .model-btn {
        display: block;
        width: 100%;
        text-align: left;
        direction: ltr;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 13px;
        border-radius: 8px;
      }

      .chipset-btn { border-color: rgba(13,110,253,0.15); color: #0d6efd; }
      .model-btn { border-color: rgba(25,135,84,0.12); color: #198754; }

      /* ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¨Ø­Ø³Ø¨ Ø§Ù„Ø¹Ø±Ø¶ */
      .col-lg-custom {
        flex: 0 0 20%;
        max-width: 20%;
      }
      @media (max-width: 1199.98px) {
        .col-lg-custom { flex: 0 0 33.3333%; max-width: 33.3333%; }
      }
      @media (max-width: 767.98px) {
        .col-lg-custom { flex: 0 0 48%; max-width: 48%; }
      }
      @media (max-width: 479.98px) {
        .col-lg-custom { flex: 0 0 100%; max-width: 100%; }
      }

      /* ØµÙ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ØªØ¨Ø§Ø¹Ø¯ Ù…ØªÙ†Ø§Ø³Ù‚ */
      .results-row {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
      }

      /* ===========================
         Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª (Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„)
         =========================== */

      .aps-feature-card {
        background: linear-gradient(180deg, #f8fbff 0%, #ffffff 100%);
        padding: 16px;
        border-radius: 12px;
        box-shadow: 0 6px 18px rgba(12, 28, 55, 0.04);
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .aps-list-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        color: #fff;
        margin-bottom: 10px;
      }

      /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù…Ù„ÙˆÙ†Ø© Ù„ÙƒÙ„ Ù†ÙˆØ¹ */
      .aps-icon-mobile { background: #0d6efd; }
      .aps-icon-cpu { background: #198754; }
      .aps-icon-camera { background: #fd7e14; }
      .aps-icon-hdd { background: #6f42c1; }
      .aps-icon-code { background: #20c997; }
      .aps-icon-battery { background: #ffc107; color: #000; }

      .aps-feature-info strong { color: #111; font-size: 15px; }
      .aps-feature-info span { font-size: 14px; color: #333; text-align: center; }

      /* ØªÙ†Ø³ÙŠÙ‚ ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
      .nav-tabs { overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; }
      .nav-tabs .nav-link { font-weight: 600; color: #0d6efd; border-radius: 10px 10px 0 0; margin: 2px; }
      .nav-tabs .nav-link.active { background-color: #0d6efd; color: #fff; }

      /* tooltip-popup (ÙÙŠ Ø­Ø§Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹) */
      .tooltip-popup {
        position: absolute;
        background: #222;
        color: #fff;
        padding: 8px 10px;
        border-radius: 8px;
        font-size: 13px;
        max-width: 260px;
        line-height: 1.5;
        z-index: 9999;
        box-shadow: 0 6px 20px rgba(0,0,0,0.25);
      }

      /* ØªØ­Ø³ÙŠÙ†Ø§Øª ØµØºÙŠØ±Ø© Ù„Ù„Ø¹Ø±Ø¶ */
      .aps-main-image img { width: 100%; height: auto; border-radius: 10px; }
      .card-title small { display:block; color:#6c757d; font-weight:400; }

    </style>
  </head>
  <body>
    <div class="container">

      <!-- ===== Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« (Ù…Ø±ÙƒØ²) ===== -->
      <div class="search-modal-box">
        <div class="card border-0">
          <div class="card-body">
            <h5 class="text-center mb-3 fw-bold text-primary">ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù‡ÙˆØ§ØªÙ</h5>
            <form id="searchForm" class="text-center" autocomplete="off">
              <p class="message mb-3">Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø« Ø«Ù… Ø§Ø¶ØºØ· Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ <em>Enter</em></p>
              <input
                type="search"
                class="search-field mb-3 text-center"
                id="phoneInput"
                name="s"
                placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ù‡Ø§ØªÙ..."
                required
              />
              <button type="submit" class="btn btn-primary w-100 py-2 fw-bold">Ø¨Ø­Ø«</button>
            </form>
          </div>
        </div>
      </div>

      <!-- ===== Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« ===== -->
      <div class="card shadow-sm border-0 rounded-4 mb-4">
        <div class="card-body">
          <h5 class="text-center mb-4 text-primary fw-bold">ğŸ“± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</h5>
          <div id="result" class="row g-4 justify-content-center"></div>
        </div>
      </div>

    </div>

    <!-- ===== Ù…ÙˆØ¯Ø§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª ===== -->
    <div class="modal fade" id="specsModal" tabindex="-1" aria-labelledby="specsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content shadow-lg rounded-4">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="modalTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‡Ø§ØªÙ</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
          </div>
          <div class="modal-body" id="specsModalBody">
            <div class="text-center py-5">
              <div class="spinner-border text-primary" role="status"></div>
              <p class="mt-3 text-muted">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===========================
         Ø³ÙƒØ±Ø¨ØªØ§Øª JavaScript (Ù…Ù†Ù‚Ù‘Ø­Ø©)
         =========================== -->
    <script>
      // -----------------------------
      // Ù…ÙØ¹Ø§Ù„Ø¬Ø© Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
      // -----------------------------
      async function getDetails(url, phoneImg) {
        const modalBody = document.getElementById("specsModalBody");
        modalBody.innerHTML = `<div class='alert alert-info text-center'>ğŸ“± Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª...</div>`;

        try {
          const res = await fetch(`/api/details?url=${encodeURIComponent(url)}`);
          const data = await res.json();

          if (data.error) {
            modalBody.innerHTML = `<div class='alert alert-danger text-center'>âŒ ${data.error}</div>`;
            return;
          }

          // ---------- ØªØ¹Ø±ÙŠÙ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø±Ù…ÙˆØ² ----------
          const sections = {
            "Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©": ["Ø§Ù„Ø¥ØµØ¯Ø§Ø±", "Ø§Ù„Ù…Ø§Ø±ÙƒØ©", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„Ù†ÙˆØ¹", "Ø§Ù„Ø®Ø§Ù…Ø©"],
            "Ø§Ù„Ø³Ø¹Ø±": ["Ø§Ù„Ø³Ø¹Ø±", "Price", "Ø§Ù„Ø£Ø³Ø¹Ø§Ø±"],
            "Ø§Ù„Ù†Ø¸Ø§Ù…": ["Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„", "Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©", "Ø§Ù„Ø¥ØµØ¯Ø§Ø±"],
            "Ø§Ù„Ø´Ø§Ø´Ø©": ["Ø§Ù„Ø´Ø§Ø´Ø©", "Ø§Ù„Ù†ÙˆØ¹", "Ø§Ù„Ø¯Ù‚Ø©", "Ø§Ù„Ø³Ø·ÙˆØ¹", "Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«"],
            "Ø§Ù„Ø°Ø§ÙƒØ±Ø©": ["Ø§Ù„Ø°Ø§ÙƒØ±Ø©", "Ø§Ù„ØªØ®Ø²ÙŠÙ†", "SD", "Ø§Ù„Ø±Ø§Ù…"],
            "Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯": ["Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯", "Ø§Ù„ÙˆØ²Ù†", "Ø§Ù„Ø­Ø¬Ù…"],
            "Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§": ["Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§", "Ø§Ù„Ø®Ù„ÙÙŠØ©", "Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©", "Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"],
            "Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©": ["Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©","Ø§Ù„Ø´Ø­Ù†","Ø§Ù„Ø³Ø¹Ø©"],
            "Ø§Ù„ØµÙˆØª": ["Ø§Ù„ØµÙˆØª", "Ø³Ù…Ø§Ø¹Ø§Øª", "Ø¬Ø§Ùƒ"],
            "Ø£Ø®Ø±Ù‰": []
          };

          const icons = {
            "Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©": "ğŸ“‹",
            "Ø§Ù„Ø³Ø¹Ø±": "ğŸ’°",
            "Ø§Ù„Ù†Ø¸Ø§Ù…": "âš™ï¸",
            "Ø§Ù„Ø´Ø§Ø´Ø©": "ğŸ“±",
            "Ø§Ù„Ø°Ø§ÙƒØ±Ø©": "ğŸ’¾",
            "Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯": "ğŸ“",
            "Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§": "ğŸ“¸",
            "Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©": "ğŸ”‹",
            "Ø§Ù„ØµÙˆØª": "ğŸ”ˆ",
            "Ø£Ø®Ø±Ù‰": "ğŸ“"
          };

          // ---------- ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ----------
          const grouped = {};
          if (data.specs && typeof data.specs === "object") {
            for (const [key, val] of Object.entries(data.specs)) {
              let found = false;
              for (const [section, keywords] of Object.entries(sections)) {
                if (keywords.some((k) => key.includes(k))) {
                  (grouped[section] ??= []).push({ key, val });
                  found = true;
                  break;
                }
              }
              if (!found) (grouped["Ø£Ø®Ø±Ù‰"] ??= []).push({ key, val });
            }
          }

          // ---------- Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© (ØªÙ†Ø¸ÙŠÙ Ùˆ Ø§Ø³ØªØ®Ø±Ø§Ø¬) ----------
          function extractScreenInfo(screenRaw) {
            if (!screenRaw) return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
            const text = String(screenRaw);

            const typeMatch = text.match(/(IPS\s*LCD|AMOLED|OLED|Super\s*AMOLED|LTPO|PLS|TFT)/i);
            const type = typeMatch ? typeMatch[0].replace(/\s+/g, " ").trim().toUpperCase() : "";

            const sizeMatch = text.match(/(\d+(\.\d+)?)\s*(Ø¨ÙˆØµØ©|Ø¨ÙˆØµÙ‡|inch|")/i);
            const size = sizeMatch ? `${sizeMatch[1]} Ø¨ÙˆØµØ©` : "";

            let res = "";
            if (/FHD/i.test(text)) res = "Ø¨Ø¯Ù‚Ø© FHD+";
            else if (/HD\+/i.test(text)) res = "Ø¨Ø¯Ù‚Ø© HD+";
            else if (/QHD/i.test(text)) res = "Ø¨Ø¯Ù‚Ø© QHD+";
            else if (/UHD|4K/i.test(text)) res = "Ø¨Ø¯Ù‚Ø© 4K";
            else {
              const resMatch = text.match(/(\d{3,4})\s*[xÃ—]\s*(\d{3,4})/i);
              if (resMatch) {
                const width = Math.max(resMatch[1], resMatch[2]);
                res = width >= 2000 ? "Ø¨Ø¯Ù‚Ø© FHD+" : "Ø¨Ø¯Ù‚Ø© HD+";
              }
            }

            if (type || size || res) {
              return `${type}${type && size ? " Ø¨Ø­Ø¬Ù… " : ""}${size}${(type || size) && res ? " " : ""}${res}`.trim();
            } else {
              return text;
            }
          }

          function extractCameraMP(textRaw) {
            if (!textRaw) return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
            const text = String(textRaw);
            const matches = text.match(/(\d+)\s*(?:Ù…ÙŠØ¬Ø§|Ù…\.Ø¨|MP|mp)/gi);
            if (!matches) return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
            const clean = matches.map((m) => m.replace(/\D/g, ""));
            return clean.join("+") + " Ù….Ø¨";
          }

          function extractMemoryInfo(specsObj) {
            const storageKey = Object.keys(specsObj || {}).find((k) => /Ø°Ø§ÙƒØ±Ø©|ØªØ®Ø²ÙŠÙ†|Ø¯Ø§Ø®Ù„ÙŠØ©/i.test(k)) || "";
            const ramKey = Object.keys(specsObj || {}).find((k) => /Ø±Ø§Ù…|Ø§Ù„Ø±Ø§Ù…Ø§Øª|Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©/i.test(k)) || "";
            const storage = storageKey ? String(specsObj[storageKey]).replace(/\s*\.\s*$/, "") : "";
            const ram = ramKey ? String(specsObj[ramKey]).replace(/\s*\.\s*$/, "") : "";
            if (storage && ram) return `${storage} + ${ram}`;
            else if (storage) return storage;
            else if (ram) return ram;
            else return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
          }

          function extractBatteryInfo(specsObj) {
            const capacity = specsObj["Ø³Ø¹Ø© Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©"] || specsObj["Battery Capacity"] || "";
            const charging = specsObj["Ù‚Ø¯Ø±Ø© Ø§Ù„Ø´Ø­Ù†"] || specsObj["Ø§Ù„Ø´Ø­Ù†"] || "";
            if (!capacity && !charging) return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";

            let capClean = "";
            if (capacity) {
              capClean = String(capacity).replace(/Ù…Ù„ÙŠ|Ù…Ù„Ù„ÙŠ|mAh/gi, "").trim().replace(/\.+$/, "");
              if (capClean) capClean = `${capClean} Ù….Ø£`;
            }
            let chargeClean = "";
            if (charging) {
              chargeClean = String(charging).replace(/ÙˆØ§Ø·|W/gi, "").trim().replace(/\.+$/, "");
              if (chargeClean) chargeClean = `${chargeClean} ÙˆØ§Ø·`;
            }
            if (capClean && chargeClean) return `${capClean} / ${chargeClean}`;
            if (capClean) return capClean;
            if (chargeClean) return chargeClean;
            return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
          }

          // ---------- Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ÙˆØ§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª ----------
          const tabs = Object.keys(sections);
          const navTabs = tabs
            .map(
              (tab, i) => `
              <li class="nav-item" role="presentation">
                <button class="nav-link ${i === 0 ? "active" : ""}" id="tab-${i}" data-bs-toggle="tab" data-bs-target="#content-${i}" type="button" role="tab">
                  ${icons[tab] || ""} ${tab}
                </button>
              </li>`
            )
            .join("");

          const tabContents = tabs
            .map((tab, i) => {
              // ØªØ¨ÙˆÙŠØ¨ "Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©" ÙŠØ¨Ù†ÙŠ Ø§Ù„ÙƒØ±ÙˆØª Ø§Ù„Ù…Ø®ØªØµØ±Ø© ÙˆØ§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
              if (tab === "Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©") {
                const mainImage = phoneImg || data.img || "";
                const title = data.title || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

                // Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø·Ø§Ù‚Ø§Øª Ù‚ØµÙŠØ±Ø© ØªØ¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (ØªÙØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£ØµÙ„ÙŠ)
                const shortCards = [
                  {
                    key: "Ø§Ù„Ø´Ø§Ø´Ø©",
                    val: extractScreenInfo(data.specs?.["Ø§Ù„Ø´Ø§Ø´Ø©"] || data.specs?.["Display"] || grouped["Ø§Ù„Ø´Ø§Ø´Ø©"]?.[0]?.val || ""),
                    icon: "aps-icon-mobile",
                  },
                  {
                    key: "Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬",
                    val: data.specs?.["Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬"] || data.specs?.["Chipset"] || grouped["Ø§Ù„Ù†Ø¸Ø§Ù…"]?.[0]?.val || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯",
                    icon: "aps-icon-cpu",
                  },
                  {
                    key: "Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª",
                    val: (() => {
                      const backRaw = data.specs?.["ÙƒØ§Ù…ÙŠØ±Ø§ Ø®Ù„ÙÙŠØ©"] || data.specs?.["Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©"] || data.specs?.["Back Camera"] || "";
                      const frontRaw = data.specs?.["ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù…Ø§Ù…ÙŠØ©"] || data.specs?.["Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©"] || data.specs?.["Front Camera"] || "";
                      const back = extractCameraMP(backRaw);
                      const front = extractCameraMP(frontRaw);
                      if (back !== "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©" && front !== "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©") return `Ø®Ù„ÙÙŠØ© ${back} / Ø£Ù…Ø§Ù…ÙŠØ© ${front}`;
                      if (back !== "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©") return `Ø®Ù„ÙÙŠØ© ${back}`;
                      if (front !== "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©") return `Ø£Ù…Ø§Ù…ÙŠØ© ${front}`;
                      return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
                    })(),
                    icon: "aps-icon-camera",
                  },
                  {
                    key: "Ø§Ù„Ø°Ø§ÙƒØ±Ø© + Ø§Ù„Ø±Ø§Ù…",
                    val: extractMemoryInfo(data.specs),
                    icon: "aps-icon-hdd",
                  },
                  {
                    key: "Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„",
                    val: data.specs?.["Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„"] || data.specs?.["OS"] || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯",
                    icon: "aps-icon-code",
                  },
                  {
                    key: "Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©",
                    val: extractBatteryInfo(data.specs),
                    icon: "aps-icon-battery",
                  }
                ];

                const cardsHtml = shortCards
                  .map(
                    (item) => `
                    <div class="col-12 col-md-6 mb-3">
                      <div class="aps-feature-card">
                        <div class="aps-list-icon ${item.icon}">${/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø±Ù…Ø²ÙŠØ© Ø¥Ù† Ø§Ø­ØªØ¬Øª */ ""}</div>
                        <div class="aps-feature-info text-center mt-1">
                          <strong>${item.key}</strong><br>
                          <span>${item.val}</span>
                        </div>
                      </div>
                    </div>`
                  )
                  .join("");

                return `
                  <div class="tab-pane fade show active" id="content-${i}" role="tabpanel">
                    <div class="d-flex flex-column flex-lg-row align-items-center gap-4">
                      <div class="text-center flex-shrink-0">
                        <div class="aps-main-image mb-3" style="max-width:400px;">
                          <img fetchpriority="high" class="rounded shadow-sm" src="${mainImage}" alt="${title}" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'">
                        </div>
                        <h4 class="fw-bold mt-2">${title}</h4>
                      </div>

                      <div class="flex-grow-1 w-100">
                        <div class="row g-3">
                          ${cardsHtml}
                        </div>
                      </div>
                    </div>
                  </div>`;
              }

              // ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø³Ø¹Ø± (Ø¹Ø±Ø¶ Ø®Ø§Øµ)
              if (tab === "Ø§Ù„Ø³Ø¹Ø±") {
                const priceVal = grouped["Ø§Ù„Ø³Ø¹Ø±"]?.[0]?.val || "ØºÙŠØ± Ù…ØªÙˆÙØ±";
                return `<div class="tab-pane fade" id="content-${i}" role="tabpanel">
                  <div class="card border-success text-center shadow-sm p-4 bg-light">
                    <h4 class="text-success fw-bold mb-3">ğŸ’° Ø§Ù„Ø³Ø¹Ø±</h4>
                    <p class="fs-4 text-success">${priceVal}</p>
                  </div>
                </div>`;
              }

              // Ø¨Ù‚ÙŠØ© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª: Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© key - value Ø£Ùˆ Ø±Ø³Ø§Ù„Ø© Ø¹Ø¯Ù… ØªÙˆÙØ± Ø¨ÙŠØ§Ù†Ø§Øª
              const sectionItems = grouped[tab]?.length
                ? grouped[tab]
                    .map(
                      (item) =>
                        `<li class="list-group-item d-flex justify-content-between align-items-center"><strong>${item.key}</strong><span>${item.val}</span></li>`
                    )
                    .join("")
                : "<li class='list-group-item text-center text-muted'>âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©.</li>";

              return `<div class="tab-pane fade" id="content-${i}" role="tabpanel"><ul class="list-group list-group-flush">${sectionItems}</ul></div>`;
            })
            .join("");

          // Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
          modalBody.innerHTML = `
            <ul class="nav nav-tabs justify-content-center flex-wrap" id="specTabs" role="tablist">${navTabs}</ul>
            <div class="tab-content p-3 border border-top-0 rounded-bottom bg-light mt-1" id="specTabsContent">${tabContents}</div>
          `;

          // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ø¨Ø± Bootstrap
          const modalEl = document.getElementById("specsModal");
          const modalInstance = new bootstrap.Modal(modalEl);
          modalInstance.show();
        } catch (err) {
          console.error(err);
          modalBody.innerHTML = `<div class='alert alert-danger text-center'>âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</div>`;
        }
      }

      // -----------------------------
      // Ø§Ù„Ø¨Ø­Ø« ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙÙŠ #result
      // -----------------------------
      (function setupSearchHandler() {
        const form = document.getElementById("searchForm");
        const input = document.getElementById("phoneInput");
        const resultDiv = document.getElementById("result");

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          const phone = input.value.trim();
          if (!phone) return;

          // Ø±Ø³Ø§Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø±
          resultDiv.innerHTML = `<div class='alert alert-info w-100 text-center'>ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "${phone}"...</div>`;

          try {
            const res = await fetch(`/api/${encodeURIComponent(phone)}`);
            const data = await res.json();

            if (data.error) {
              resultDiv.innerHTML = `<div class='alert alert-danger w-100 text-center'>âŒ ${data.error}</div>`;
              return;
            }

            // ÙˆØ¶Ø¹ Ù…Ù†ÙØµÙ„ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (list mode) Ø£Ùˆ ØªÙØ§ØµÙŠÙ„ Ù…ÙØ±Ø¯Ø© (details mode)
            if (!data.mode || data.mode === "list") {
              // Ø¹Ø±Ø¶ Ø´Ø¨ÙƒØ© Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
              let cards = "";
              if (!Array.isArray(data.results) || data.results.length === 0) {
                cards = `<div class="alert alert-warning w-100 text-center">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬.</div>`;
              } else {
                for (const item of data.results) {
                  const chipsetText = Array.isArray(item.chipset) ? item.chipset.join(", ") : item.chipset || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                  const modelText = Array.isArray(item.model) ? item.model.join(", ") : item.model || "";
                  const imgHtml = item.img
                    ? `<div class="card-img-wrapper position-relative" style="z-index:1;">
                         <img src="${item.img}" class="card-img-top rounded-top" alt="${item.title}" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'">
                       </div>`
                    : "";

                  cards += `
                    <div class="col-lg-custom mb-3" style="flex:0 0 20%; max-width:20%;">
                      <div class="card phone-card shadow-sm rounded-4 h-100 position-relative"
                           data-url="${item.link || ''}"
                           data-img="${item.img || ''}"
                           data-title="${(item.title || '').replace(/"/g, '&quot;')}"
                           style="min-width:220px;">
                        ${imgHtml}
                        <div class="card-body text-center d-flex flex-column position-relative" style="overflow: visible; z-index:2;">
                          <h6 class="card-title fw-bold mb-2">${item.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</h6>
                          <div class="d-flex flex-column gap-2 text-muted small w-100">
                            <button type="button"
                              class="btn btn-sm btn-outline-primary chipset-btn px-3 py-1"
                              data-bs-toggle="popover"
                              data-bs-trigger="hover focus"
                              title="âš™ï¸ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬"
                              data-bs-content="${(item.chipsetTooltip || chipsetText || '').replace(/"/g, '&quot;')}">
                              ${chipsetText}
                            </button>
                            ${modelText ? `<button type="button"
                              class="btn btn-sm btn-outline-success model-btn px-3 py-1"
                              data-bs-toggle="popover"
                              data-bs-trigger="hover focus"
                              title="ğŸ“± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ ÙˆØ§Ù„Ø·Ø±Ø§Ø²"
                              data-bs-content="${(item.modelTooltip || modelText || '').replace(/"/g, '&quot;')}">
                              ${modelText}
                            </button>` : ''}
                          </div>
                        </div>
                      </div>
                    </div>`;
                }
              }

              // Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
              resultDiv.innerHTML = `<div class="results-row w-100">${cards}</div>`;

              // ØªÙØ¹ÙŠÙ„ popovers Ù…Ù† Bootstrap
              const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
              popoverTriggerList.map((el) =>
                new bootstrap.Popover(el, {
                  placement: "top",
                  container: "body",
                  html: true,
                })
              );

              // Ø¶Ø¨Ø· Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù„Ù„Ø¹Ø±Ø¶ (ØªØ¹ÙˆÙŠØ¶ flex values Ù„Ù„Ù…ØªØµÙØ­Ø§Øª)
              // ØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„Ù…Ø±Ù†Ø© Ø£Ø¹Ù„Ø§Ù‡ ÙÙŠ CSS
            } else if (data.mode === "details") {
              // ÙÙŠ Ø­Ø§Ù„Ø© mode: details Ù†Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ù…ÙØ±Ø¯Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª data (ÙˆÙ„ÙŠØ³ item ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ)
              const img = data.img || '';
              const title = data.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
              const chipset = data.chipset || '';
              const model = data.model || '';

              resultDiv.innerHTML = `
                <div class="w-100">
                  <div class="card phone-card p-0" data-url="${data.link || ''}" data-img="${img}">
                    ${img ? `<img src="${img}" class="card-img-top" alt="${title}" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'">` : ''}
                    <div class="card-body">
                      <h6 class="card-title">${title}</h6>
                      ${chipset ? `<button class="btn btn-outline-primary btn-sm mb-2">${chipset}</button>` : ''}
                      ${model ? `<button class="btn btn-outline-success btn-sm">${model}</button>` : ''}
                    </div>
                  </div>
                </div>
              `;
            }
          } catch (err) {
            console.error(err);
            resultDiv.innerHTML = `<div class='alert alert-danger w-100 text-center'>âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</div>`;
          }
        });

        // ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¨Ø·Ø§Ù‚Ø© (delegation Ø¹Ù„Ù‰ #result)
        resultDiv.addEventListener("click", (e) => {
          const card = e.target.closest(".phone-card");
          if (!card) return;
          const url = card.dataset.url || "";
          const img = card.dataset.img || "";
          getDetails(url, img);
        });
      })();
    </script>

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
